{% extends 'base.html' %}
{% block title %}Startseite – DEBA AuftragsControl{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">{{ begruessung }}, {{ vorname or '' }} {{ nachname or '' }} 👋</h2>

  <!-- 📘 Anleitung – ein- und ausklappbar -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
      <span>📘 Anleitung zur Nutzung der Faktura-App</span>
      <button class="btn btn-primary btn-sm shadow-sm rounded-pill" type="button" data-bs-toggle="collapse" data-bs-target="#anleitungText">
        📖 Anzeigen / Verbergen
      </button>
    </div>
    <div id="anleitungText" class="collapse">
      <div class="card-body">
        <p>
          Auftragsarten:
          3: Bäderauftrag<br>
          5: Handelsware<br>
          8: Reklamationen<br>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam a sem eget nulla sodales facilisis.
          Integer vel porta tortor, ut tempor nunc. Duis id fermentum nunc. Sed nec sem nec velit gravida sagittis.
        </p>
      </div>
    </div>
  </div>

  <!-- 📊 Aktuelle Aufträge -->
  <div class="card">
    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
      <span>📊 Aktuelle Aufträge</span>
      <div>
        <a href="{{ url_for('neuer_auftrag') }}" class="btn btn-sm btn-light me-2">➕ Neuer Auftrag</a>
        <a href="{{ url_for('filter_auftraege') }}" class="btn btn-sm btn-outline-light">🔍 Filter</a>
      </div>
    </div>
    <div class="card-body p-0">
      {% if auftraege %}
      <div class="table-wrapper">
        <table class="table universal-table table-hover table-sm align-middle">
          <thead class="table-secondary">
            <tr>
              <th>Auftragsnr.</th>
              <th>Bezeichnung</th>
              <th>Kunde</th>
              <th>Eingang</th>
              <th>Summe</th>
              <th>Badtypen</th>
              <th>Bäder</th>
              <th>Produziert</th>
              <th>Ausgeliefert</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for a in auftraege %}
            <tr onclick="window.location='{{ url_for('auftrag_detail', kurznummer=a.kurznummer) }}'" style="cursor: pointer;">
              <td data-label="Auftragsnr.">{{ a.auftragsnummer }}</td>
              <td data-label="Bezeichnung">{{ a.bezeichnung_kurz }}</td>
              <td data-label="Kunde">{{ a.firmenname }}</td>
              <td data-label="Eingang">{{ a.auftragseingang.strftime('%d.%m.%Y') if a.auftragseingang else '-' }}</td>
              <td data-label="Summe">{{ a.auftragssumme or 0 }} €</td>
              <td data-label="Badtypen">{{ a.badtypen_count }}</td>
              <td data-label="Bäder">{{ a.baeder_count }}</td>
              <td data-label="Produziert">{{ a.produziert_count }}</td>
              <td data-label="Ausgeliefert">{{ a.ausgeliefert_count }}</td>
              <td data-label="Status">{{ a.status }}</td>
            </tr>
            {% else %}
            <tr><td colspan="10" class="text-center">Keine aktiven Aufträge gefunden.</td></tr>
            {% endfor %}
          </tbody>         
        </table>
      </div>
      {% else %}
        <div class="p-3">Keine aktiven Aufträge vorhanden.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
